---
title : Готовимся к производству
excerpt : план проекта по развертыванию Интернета вещей с помощью {{$ names.company.lower}}
---

#  Переход в производство

Развертывание парка удаленных подключенных устройств требует тщательного планирования. Правильное решение должно учитывать, где устройства будут развернуты, что им нужно делать, как они будут обслуживаться, и, конечно же, доступный бюджет. Чтобы помочь вам начать работу, мы обрисовали в общих чертах базовый план проекта, охватывающий рекомендуемые шаги по подготовке производственного парка, а также вопросы, которые вы захотите рассмотреть в процессе.

##  Этап 1: Дизайн

Первый шаг в разработке решения - определить, как и где будут работать ваши устройства. Ваш вариант использования будет определять выбор * оборудования * и * операционной среды *, необходимых для успешного развертывания вашего приложения.

###  Оборудование

Существует ряд одноплатных компьютеров, способных поддерживать Linux и запускать приложения на периферии. Параметры сильно различаются по возможностям и цене, поэтому важно уделять пристальное внимание функциям, которые будут соответствовать потребностям вашего приложения. Независимо от выбранной вами аппаратной платформы необходимо учитывать следующее:

* ЦП: есть ли у вас программные компоненты, требующие архитектуры x86? Чипы ARM часто дешевле и потребляют меньше энергии, но x86 часто может обеспечить больше возможностей обработки.
* RAM: убедитесь, что у вас есть удобный буфер памяти. Программное обеспечение должно иметь возможность развиваться в соответствии с изменяющимися потребностями бизнеса, и вы можете обнаружить, что развертываете новые функции, выходящие за рамки того, что вы изначально планировали. Наличие большого количества доступной памяти позволит вам сэкономить время и усилия (и, возможно, дорогое обновление) позже.
* Периферийные устройства: существуют ли специальные аппаратные устройства, которым потребуются специальные драйверы?
* Хранение: SD-карты распространены во встроенных устройствах, но они медленнее и * намного * менее надежны, чем встроенные флеш-накопители. Особенно, если ваше приложение будет выполнять много циклов чтения / записи, отказ от хранения SD снизит риск повреждения данных. При использовании SD-карт мы рекомендуем SD-карты SanDisk Extreme Pro.
* Питание: не все блоки питания полностью совместимы со всеми платами (особенно с USB). Перед широкомасштабным развертыванием важно подтвердить, что источник питания действительно способен обеспечивать требуемую мощность. При использовании каких-либо периферийных устройств требования к питанию будут выше номинальных значений платы.

Конечно, самый важный выбор, который вам нужно сделать, - это использовать ли стандартное оборудование или настраиваемое устройство. Готовое устройство имеет множество преимуществ, включая более низкую цену, более быструю доступность и более широкую отраслевую поддержку. Но возможно, что ни одно из существующих устройств полностью не отвечает вашим потребностям. В этом случае очень важно подумать о своей операционной среде - вы должны быть уверены, что она будет работать с вашим оборудованием и что ее можно обновлять с помощью последних исправлений безопасности.


###  Операционная среда

Одна из проблем при создании приложений для распределенных парков - согласование вашей среды разработки с операционной средой, работающей на ваших устройствах. Вам понадобится способ убедиться, что ваше приложение и его зависимости работают с архитектурой вашего устройства, а также план для отправки обновлений в ваш парк без потери доступа к вашим устройствам.

{{$ names.company.upper}} решает эти проблемы, используя {{$ names.os.lower}}, базовую ОС хоста с легким, совместимым с Docker механизмом контейнеров, [ {{$ names.engine .lower}} ] [ссылка на двигатель]. С помощью контейнеров вы можете разработать свое приложение наиболее удобным для вас способом, а затем запустить эту среду на своем устройстве, не беспокоясь о базовой аппаратной поддержке. Любые зависимости, такие как библиотеки и среды выполнения, уже будут упакованы в контейнер.

Контейнеры также упрощают удаленное обновление. Новый выпуск можно загрузить, проверить и запустить, пока ОС хоста поддерживает сетевое соединение и решает любые проблемы.

Следует учитывать, хотите ли вы использовать один контейнер или несколько. У каждого подхода есть свои преимущества. Управлять одним контейнером проще всего - нет необходимости беспокоиться о межконтейнерном взаимодействии или конфликте ресурсов. Но это означает, что вам нужно будет управлять всеми компонентами вашего приложения в одном месте.

Использование нескольких контейнеров позволяет разделить компоненты и даже группы разработчиков. Разделение вашего приложения на контейнерные службы может, например, позволить одной команде работать над внешним интерфейсом вашего приложения, в то время как другая работает над внутренним интерфейсом, при этом каждая команда отправляет обновления независимо. Разные команды могут даже использовать совершенно разные операционные среды: одна команда может использовать Debian, а другая - Fedora. Это требует некоторой координации, так как вам нужно будет назначить ресурсы, необходимые каждому контейнеру, через что-то вроде файла [ Docker Compose ] [docker-compose].


##  Этап 2: прототип

На этапе прототипирования важно разрабатывать на том же устройстве, которое вы будете использовать в своем производственном парке. Может возникнуть соблазн использовать виртуальное устройство, но у этого подхода есть ряд недостатков. С виртуальными устройствами, как правило, труднее работать, чем с физическими устройствами, и они часто намного медленнее. Придерживаясь одного и того же устройства на этапах прототипа, пилотного проекта и производства, вы снизите риск любых неожиданных сбоев на этом пути.

Убедитесь, что у вас есть легкий доступ к устройству, особенно в случае, если что-то пойдет не так. Лучше всего создать прототип в местной лаборатории под вашим контролем. На этом этапе разработки ваше приложение является неполным и не полностью протестированным, поэтому вам нужна безопасная среда, в которой вы можете быстро разрабатывать без риска раскрытия данных извне.

На этапе прототипирования начинают действовать некоторые из ориентированных на разработчиков функций {{$ names.company.lower}}, предлагая несколько способов доступа к ОС хоста и контейнерам, работающим на вашем устройстве:

###  Образы для проявки

При разработке нового приложения вам следует рассмотреть возможность использования [ образ для разработки ] [dev-vs-prod] {{$ names.os.lower}}. Эти образы имеют ряд функций, которые по соображениям безопасности отсутствуют в производственных версиях {{$ names.os.lower}}. К ним относятся:

* SSH-доступ без пароля к ОС хоста
* Доступ к сокету Docker
* Последовательный и консольный журнал и интерактивный вход
* Функциональность в локальном режиме

###  Локальный режим

{{$ names.os.upper}} [ локальный режим ] [локальный режим] дает вам возможность создавать и развертывать на устройстве в локальной сети без использования облачного конструктора {{$ names.company.lower}}. Это позволяет очень быстро выполнять итерацию и тестировать функциональность - во многих случаях, таких как изменения конфигурации или изменения, внесенные в код на интерпретируемом языке, обновления могут быть развернуты, вообще не требуя сборки. Локальное развертывание позволяет напрямую отразить вашу среду разработки на тестовом устройстве.

###  Связь

Во время создания прототипа вы должны начать думать о том, как ваши устройства будут подключены при развертывании в реальном мире. Если есть возможность предварительно сконфигурировать сетевые настройки или сделать все с помощью DHCP, это легко. Но для большинства устройств потребуется настройка на месте.

{{$ names.company.upper}} предоставляет возможность настраивать сеть изнутри контейнеров и предоставляет множество функций, упрощающих эту задачу. Одним из примеров является проект [ wifi-connect ] [wifi-connect], который позволяет устройству создавать собственную точку доступа Wi-Fi, к которой пользователи могут подключаться для настройки правильных учетных данных. {{$ Names.company.lower}} [ supervisor API ] [supervisor-api] также позволяет настраивать более сложные сетевые параметры, включая конфигурацию имени хоста и прокси.

###  Несколько разработчиков

На этапе создания прототипа вы можете разрешить нескольким разработчикам совместно использовать ресурсы. С помощью {{$ names.company.lower}} вы можете добавить нескольких разработчиков в качестве [ соавторов ] [соавторов] в парк, давая им возможность управлять устройствами парка и отправлять обновления кода.

##  Этап 3: Пилот

После того, как разработка вашего приложения в основном будет завершена, важно провести еще несколько реальных испытаний. {{$ names.company.upper}} предоставляет функциональные возможности, которые также упрощают эту задачу, предоставляя инструменты, которые помогут вам перейти от этапа прототипа к полноценной производственной среде:

###  Производственные изображения

На этом этапе имеет смысл перейти от образов {{$ names.os.lower}} для разработки к полным производственным образам, гарантируя, что ваше приложение по-прежнему работает должным образом без полного доступа к локальной консоли. Вы по-прежнему можете [ получить доступ ] [ssh] к ОС и контейнерам хоста через панель управления {{$ names.company.lower}} и интерфейс командной строки, но рабочий образ {{$ names.os.lower}} закроет все открытые входящие порты. .

Для пользователей производственного и корпоративного планов, которым требуется стабильный поддерживаемый выпуск, следует выбрать [ ESR-версия ] [esr] ОС хоста. Версия ESR гарантирует, что вам нужно будет обновлять хост-ОС на устройствах не чаще двух раз в год, чтобы убедиться, что вы используете поддерживаемую версию. Вы можете просмотреть устройства с ESR-версиями ОС хоста [ здесь ] [esr-devices].

###  Тест вне лаборатории

Тестирование вне лаборатории поможет вам увидеть, как ваше устройство ведет себя в сетях, которые вы не полностью контролируете. В идеале это должно быть сделано в среде, которая имитирует то, где будут находиться ваши устройства, когда они находятся в производстве, но при этом, по крайней мере, в некоторой степени доступна. Например, если вы создаете потребительское устройство, вы можете попросить своих сотрудников и их семьи протестировать его дома. Вы также можете искать клиентов, которые готовы стать альфа-тестерами, которые могут оставить отзыв о вашем приложении, понимая, что это еще не совсем сделано.

###  Сбор журналов

Очень важно, чтобы вы могли получать журналы и телеметрию со своих устройств, когда они находятся вне лаборатории. Вы можете использовать функцию ведения журнала консоли, представленную на панели управления {{$ names.cloud.lower}}, чтобы читать журналы приложений.

Если ваше приложение генерирует достаточно данных журналов, чтобы вам нужна аналитическая платформа, чтобы разобраться во всем, рассмотрите возможность [ добавления агента сбора журналов ] [custom-logging] в свои контейнеры, как и в любой другой среде.

###  Обновление тестирования

Обязательно протестируйте все возможности обновления, которые вы можете сделать, прежде чем ваши устройства станут недоступными и недоступными. Как для выпуска, так и для обновлений ОС {{$ names.company.lower}} включает ряд функций, чтобы убедиться, что процесс обновления не влияет на вашу способность подключаться к вашим устройствам и восстанавливать функциональность, но вы все равно захотите чтобы понять факторы, которые могут повлиять на процесс обновления.

В частности, подумайте о тестировании:

* потеря мощности во время обновления
* потеря сети при обновлении
* отправка нового обновления, пока выполняется другое

Понимание того, как ваши устройства справляются с неблагоприятными условиями, позволяет быть уверенным в способности вашего парка своевременно получать обновления.

##  Этап 4: Производство

Теперь, когда ваше тестирование подходит к концу, пришло время представить ваши устройства целым флотом! На этом этапе вы перейдете от перспективы, в первую очередь ориентированной на разработку, к перспективе, в первую очередь, ориентированной на операции, по крайней мере, для текущей версии вашего приложения. Конечно, вы можете продолжить разработку следующей версии, зная, что вы можете безопасно развернуть обновления для своего парка в любой момент с помощью {{$ names.company.lower}}!

###  Предварительная загрузка образов и предварительная регистрация устройств

Хотя устройство само подготовится и загрузит ваш последний выпуск, как только оно будет включено и подключено к Интернету, это может быть не тем опытом, который вы хотите, чтобы ваши пользователи получали. Было бы неплохо иметь что-то, что работает сразу, вместо того, чтобы ждать завершения потенциально медленной загрузки.

К счастью, вы можете [ предварительно загрузить ] [предварительно загрузить] свой выпуск в образ {{$ names.os.lower}} за один раз. Затем, когда этот образ будет записан на ваши устройства на заводе, он будет иметь уже установленную и готовую версию. Любые обновления, внесенные в автопарк после процесса предварительной загрузки, будут загружены и применены, когда устройство будет подключено к сети, поэтому вам не нужно беспокоиться об устройствах, которые находились на складе или на полках магазинов.

В ситуациях, когда вам необходимо зарегистрировать свои устройства до того, как они будут включены или подключены к сети, вы можете [ предварительно зарегистрировать ] [предварительно зарегистрировать] их. Предварительная регистрация устройства позволяет создавать индивидуально зарегистрированные устройства в парке, что чрезвычайно полезно в таких ситуациях, как производство, где устройство может требовать отслеживания, поскольку конкретный UUID устройства затем может быть связан с конкретным заказом клиента.

Дополнительную информацию о предварительной загрузке образов и предварительной регистрации устройств можно найти в [ Расширенный мастер-класс CLI ] [cli-advanced-masterclass] или в [ документации CLI ] [cli].

###  Канарские развертывания

При обновлении программного обеспечения на производственных устройствах имеет смысл проявить осторожность и начать с нескольких устройств, чтобы убедиться, что все идет не так. Обычная практика - начать с нескольких «канареечных» устройств, а затем постепенно развернуть обновление на все большее и большее количество устройств.

API {{$ names.company.lower}} включает функции, которые позволяют [ детальный контроль обновлений ] [поэтапные выпуски]. С помощью этих конечных точек вы можете отключить автоматические обновления выпусков, установить целевой выпуск для всего парка или установить целевые выпуски для определенного подмножества устройств. Функции [ тег устройства ] [теги] и [ фильтр ] [фильтры] позволяют легко назначать группы устройств определенным этапам развертывания.

##  Дальнейшее чтение

Для получения дополнительной информации об общих анти-шаблонах см. [ Анти-шаблоны, или как взломать ваши {{$ names.os.lower}} устройства ] [анти-шаблоны].

[engine-link]:{{ $links.engineSiteUrl }}
[docker-compose]:https://docs.docker.com/compose/overview/
[dev-vs-prod]:/reference/OS/overview/2.x/#development-vs-production-images
[local-mode]:/learn/develop/local-mode
[wifi-connect]:{{ $links.githubOS }}/wifi-connect
[supervisor-api]:/reference/supervisor/supervisor-api/#patch-v1-device-host-config
[collaborators]:/learn/manage/account/#fleet-members
[ssh]:/learn/manage/ssh-access
[custom-logging]:{{ $links.blogSiteUrl }}/how-to-create-a-custom-logging-system-for-longer-log-retention/
[cli]:/reference/cli
[preload]:/reference/cli/#preload-image
[preregister]:/reference/cli/#device-register-fleet
[staged-releases]:{{ $links.githubLabs }}/staged-releases
[tags]:/learn/manage/filters-tags/#device-tags
[esr-devices]:/reference/OS/extended-support-release#supported-devices
[esr]:/reference/OS/extended-support-release
[filters]:/learn/manage/filters-tags/#device-filters
[anti-patterns]:/learn/more/anti-patterns
[cli-advanced-masterclass]:/learn/more/masterclasses/advanced-cli/#5-preloading-and-preregistering
